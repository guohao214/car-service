webpackJsonp([26],{"1inb":function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});i("k8oq");var n=i("cpGA"),o={data:function(){return{nodeType:"",path:"",nodeVersion:15,nodeEUI:"",baseUrl:"",ioBaseUrl:"http://io.stsctech.com:1323/go/",advanceUrl:"https://www.advastech.com/goTrans.php?action=",file:"",key:"",deviceData:[],deviceForm:[],right_check_arr:[],deviceSubmitLoading:!1,filterMethod:function(e,t){return t.searchFilter.indexOf(e)>-1}}},mounted:function(){this.getUrl(),this.deliveryDevice()},directives:{},methods:{getUrl:function(){location.href.indexOf("io.stsctech.com")>=0?this.baseUrl="http://io.stsctech.com:1323/go/":location.href.indexOf("www.smartadvancer.com")>=0?this.baseUrl="http://www.smartadvancer.com:1323/go/":location.href.indexOf("poc.stsctech.com")>=0?this.baseUrl="http://poc.stsctech.com:1323/go/":location.href.indexOf("www.advastech.com")>=0?this.baseUrl="https://www.advastech.com/goTrans.php?action=":this.baseUrl="http://127.0.0.1:1323/go/"},getCookieByName:function(e){if(document.cookie){var t,i=new RegExp("(^| )"+e+"=([^;]*)(;|$)");return(t=document.cookie.match(i))?unescape(t[2]):null}return null},setCookie:function(e,t){if(document.cookie){var i=new Date;i.setTime(i.getTime()+2592e6),document.cookie=e+"="+escape(t)+";expires="+i.toGMTString()}},submitUpload:function(){this.file=document.getElementById("fileName").files,this.key=this.file[0].name,this.$http.postDataEx("upload","getUploadToken",{},function(e){0==e.code&&(window.qiniuUrlPrefix=e.data.domain,window.qiniuUploadToken=e.data.token)});var e=n.upload(this.file,this.key,window.qiniuUrlPrefix,{},{}).subscribe({next:function(e){console.log(e)},error:function(t){console.log(t),e.unsubscribe()},complete:function(t){console.log(t),this.path=window.qiniuUrlPrefix+t.key,e.unsubscribe()}})},createPackage:function(){if(""==this.path||null==this.path||void 0==this.path)return this.$notify({title:"警告",message:"文件路径为空",type:"success"}),!1;var e={nodeType:this.nodeType,version:this.nodeVersion,url:this.path};$.ajax({url:this.baseUrl+"addNodePackageList",type:"POST",dataType:"JSON",data:e,success:function(e){this.$notify({title:"成功",message:"创建成功",type:"success"})}})},nodeVersionUp:function(){var e={nodeType:this.nodeType,nodeEUI:this.nodeEUI};$.ajax({url:this.baseUrl+"nodeVersionUp",type:"POST",dataType:"JSON",data:e,success:function(e){this.$notify({title:"成功",message:"开始升级节点",type:"success"})}})},nodeCmdReset:function(){var e={nodeEUI:this.nodeEUI};$.ajax({url:this.baseUrl+"nodeCmdReset",type:"POST",dataType:"JSON",data:e,success:function(e){this.$notify({title:"成功",message:"终止升级成功",type:"wanrnig"})}})},deliveryDevice:function(){var e=this;this.deviceData=[],this.$http.postDataEx("device","getLibraryDevice",{status:""},function(t){0==t.code&&t.data.forEach(function(t,i){e.deviceData.push({label:t.deveui,key:t.deveui,searchFilter:t.deveui})})})},transfer_change:function(e,t,i){var n=this;"left"==t&&null!=this.right_check_arr&&i.forEach(function(e,t){var i=n.right_check_arr.indexOf(e);n.right_check_arr.splice(i,1)})},right_check_change:function(e){var t=this;this.right_check_arr=[],e.forEach(function(e,i){t.right_check_arr.push(e)})},deviceSubmit:function(){this.right_check_arr.length<=0?this.$notify({title:"警告",message:"请选择要更新设备",type:"warning"}):this.deviceSubmitLoading=!0}},components:{},watch:{}},a={render:function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"node_upgrade_manager",staticStyle:{height:"100%"}},[i("el-row",{attrs:{gutter:12}},[i("el-card",{staticClass:"box-class"},[i("el-form",{ref:"form",attrs:{"label-width":"80px"}},[i("el-form-item",{attrs:{label:"节点类型"}},[i("el-select",{attrs:{placeholder:"请选择"},model:{value:e.nodeType,callback:function(t){e.nodeType=t},expression:"nodeType"}},[i("el-option",{attrs:{label:"氨气",value:"1"}}),e._v(" "),i("el-option",{attrs:{label:"厕纸",value:"7"}}),e._v(" "),i("el-option",{attrs:{label:"坑位",value:"8"}}),e._v(" "),i("el-option",{attrs:{label:"垃圾桶",value:"6"}}),e._v(" "),i("el-option",{attrs:{label:"洗手台纸巾",value:"11"}})],1)],1),e._v(" "),i("el-form-item",{attrs:{label:"节点版本"}},[i("el-input",{model:{value:e.nodeVersion,callback:function(t){e.nodeVersion=t},expression:"nodeVersion"}})],1),e._v(" "),i("el-form-item",{attrs:{label:""}},[i("input",{staticStyle:{width:"72%"},attrs:{type:"file",id:"fileName",name:"myfile"}}),e._v(" "),i("el-button",{attrs:{type:"primary"},on:{click:e.submitUpload}},[e._v("上传")])],1),e._v(" "),i("el-form-item",{attrs:{label:"文件路径"}},[i("el-input",{model:{value:e.path,callback:function(t){e.path=t},expression:"path"}})],1),e._v(" "),i("el-form-item",{attrs:{label:""}},[i("el-button",{attrs:{type:"primary"},on:{click:e.createPackage}},[e._v("创建固件更新包")])],1),e._v(" "),i("el-form-item",{attrs:{label:"NodeEUI"}},[i("el-input",{model:{value:e.nodeEUI,callback:function(t){e.nodeEUI=t},expression:"nodeEUI"}})],1),e._v(" "),i("el-form-item",{attrs:{label:""}},[i("el-button",{attrs:{type:"primary"},on:{click:e.nodeVersionUp}},[e._v("远程固件更新")]),e._v(" "),i("el-button",{attrs:{type:"primary"},on:{click:e.nodeCmdReset}},[e._v("终止升级")])],1)],1)],1)],1),e._v(" "),i("el-row",{staticStyle:{"margin-top":"20px"},attrs:{gutter:12,width:"100%"}},[i("el-transfer",{attrs:{filterable:"",titles:["设备列表","更新列表"],"filter-method":e.filterMethod,"filter-placeholder":"请输入设备编号",data:e.deviceData},on:{change:e.transfer_change,"right-check-change":e.right_check_change},model:{value:e.deviceForm,callback:function(t){e.deviceForm=t},expression:"deviceForm"}},[i("el-button",{staticClass:"transfer-footer",attrs:{slot:"right-footer",type:"primary",size:"mini",loading:e.deviceSubmitLoading},on:{click:e.deviceSubmit},slot:"right-footer"},[e._v("批量更新")])],1)],1)],1)},staticRenderFns:[]};var s=i("VU/8")(o,a,!1,function(e){i("G8Ju")},null,null);t.default=s.exports},G8Ju:function(e,t,i){var n=i("UaH4");"string"==typeof n&&(n=[[e.i,n,""]]),n.locals&&(e.exports=n.locals);i("rjj0")("ea81f388",n,!0)},UaH4:function(e,t,i){(e.exports=i("FZ+f")(!1)).push([e.i,"\n.el-transfer-panel {\n  width: 300px;\n}\n.box-class {\n  -webkit-box-shadow: 2px -1px 20px 0px #545554;\n          box-shadow: 2px -1px 20px 0px #545554;\n}\n.card-title {\n  font-weight: bold;\n  font-size: 16px;\n}\n.file {\n  position: absolute;\n  top: 0;\n  right: 85px;\n  height: 30px;\n  line-height: 30px;\n  opacity: 0;\n  width: 254px;\n}\n",""])}});